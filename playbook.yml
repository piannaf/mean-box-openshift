---
- hosts: all

  tasks:
    - name: update apt cache
      sudo: True
      apt: update_cache=yes

    #
    # The M in MEAN
    #
    - name: import MongoDB public key
      sudo: True
      command: apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv EA312927
      tags:
        - mongodb

    - name: add MongoDB repository
      sudo: True
      shell: echo "deb http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.2 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.2.list
      tags:
        - mongodb

    - name: install MongoDB
      sudo: True
      apt: name=mongodb-org update-cache=yes
      tags:
        - mongodb

    - name: start MongoDB service
      sudo: True
      service: name=mongod state=started
      tags:
        - mongodb

    #
    # The N in MEAN
    #
    - name: add nodesource ppa
      sudo: True
      shell: curl -sL https://deb.nodesource.com/setup_4.x | bash -
      tags:
        - nodejs

    - name: install nodejs
      sudo: True
      apt: name=nodejs state=latest
      tags:
        - nodejs

    - name: ensure npm 2.x for anguar-fullstack
      sudo: True
      npm: name=npm version=latest-2 global=yes state=present
      tags:
        - nodejs

    #
    # The E and A in MEAN
    #
    - name: install git for bower install
      sudo: True
      apt: name=git state=present
      tags:
        - angular
        - express

    - name: install OpenShift Client (rhc)
      sudo: True
      gem: name=rhc user_install=no state=latest
      tags:
        - angular
        - express

    - name: install Yeoman angular-fullstack generator
      sudo: True
      npm: name={{ item }} global=yes state=present
      with_items:
        - yo
        - grunt-cli
        - bower
        - generator-angular-fullstack
      tags:
        - angular
        - express
